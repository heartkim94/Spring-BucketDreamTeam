<?xml version="1.0" encoding="UTF-8"?>
<!-- mybatis map 선언 표시 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
              "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<mapper namespace="com.pknu.project.comment.dao.CommentDao">
	
	<select id="getComments" parameterType="HashMap" resultType="comment">
		select * 		
		from (select commentNum, id,commentContent,commentDate, articleNum, @rownum:=@rownum+1 as rownum
		     from	comments,
		     		(select @rownum:=0) vars
		     where boardNum=#{boardNum} AND articleNum=#{articleNum}
		     order by commentNum desc ) human 
		where rownum between 1 and #{commentRow}
	</select>
	
	<!-- 코멘트 쓰기 -->
	<insert id="insertComment" parameterType="comment">
		insert into comments values(null, #{id}, #{commentContent},now(),#{articleNum}, #{boardNum}, 0, '');
		update comments set path=commentNum where commentNum = last_insert_id();
	</insert>
	
	<!-- 코멘트 갯수 -->
	<select id="commentCount" parameterType="HashMap" resultType="int">
		select count(*) from Comments where boardNum=#{boardNum} AND articleNum=#{articleNum}
	</select>
	
	<!-- 코멘트 수정 -->
	<select id="updateGetComment" parameterType="HashMap" resultType="String">
		SELECT commentContent
		FROM Comments
		WHERE articleNum=#{articleNum} AND boardNum=#{boardNum}
	</select>
	<update id="updateComment" parameterType="HashMap">
		UPDATE Comments
		SET commentContent=${commentContent}
		WHERE commentNum=#{commentNum} AND articleNum=#{articleNum} AND boardNum=board${boardNum}
	</update>
	
	<!-- 코멘트 답글 -->
	<insert id="replyComment">
		insert into comments values(null, #{id}, #{commentContent},now(),#{articleNum}, #{boardNum}, #{parentNum}, '');
		update comments set path=concat((select path from comments where commentNum=#{parentNum}), '.', last_insert_id());
	</insert>
	
	<!-- 코멘트 삭제 -->
	<delete id="">
		
	</delete>
</mapper>